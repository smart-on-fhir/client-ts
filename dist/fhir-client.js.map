{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./node_modules/Base64/base64.js","webpack:///./node_modules/fhir.js/node_modules/Base64/base64.js","webpack:///./node_modules/fhir.js/src/decorate.js","webpack:///./node_modules/fhir.js/src/fhir.js","webpack:///./node_modules/fhir.js/src/middlewares/auth.js","webpack:///./node_modules/fhir.js/src/middlewares/bundle.js","webpack:///./node_modules/fhir.js/src/middlewares/config.js","webpack:///./node_modules/fhir.js/src/middlewares/core.js","webpack:///./node_modules/fhir.js/src/middlewares/errors.js","webpack:///./node_modules/fhir.js/src/middlewares/http.js","webpack:///./node_modules/fhir.js/src/middlewares/patient.js","webpack:///./node_modules/fhir.js/src/middlewares/references.js","webpack:///./node_modules/fhir.js/src/middlewares/search.js","webpack:///./node_modules/fhir.js/src/middlewares/url.js","webpack:///./node_modules/fhir.js/src/utils.js","webpack:///./node_modules/merge/merge.js","webpack:///./node_modules/process/browser.js","webpack:///./node_modules/tslib/tslib.es6.js","webpack:///(webpack)/buildin/module.js","webpack:///./src/Client.ts","webpack:///./src/adapter.ts","webpack:///./src/adapters/jquery.ts","webpack:///./src/index.ts","webpack:///./src/lib.ts","webpack:///./src/oauth.ts"],"names":[],"mappings":";AAAA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,kDAA0C,gCAAgC;AAC1E;AACA;;AAEA;AACA;AACA;AACA,gEAAwD,kBAAkB;AAC1E;AACA,yDAAiD,cAAc;AAC/D;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iDAAyC,iCAAiC;AAC1E,wHAAgH,mBAAmB,EAAE;AACrI;AACA;;AAEA;AACA;AACA;AACA,mCAA2B,0BAA0B,EAAE;AACvD,yCAAiC,eAAe;AAChD;AACA;AACA;;AAEA;AACA,8DAAsD,+DAA+D;;AAErH;AACA;;;AAGA;AACA;;;;;;;;;;;;AClFA,CAAC;;AAED;AACA,IAAI,KAA6B;AACjC,IAAI,SACQ,CAAC;;AAEb;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA;AACA,iDAAiD;AACjD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH,CAAC;;;;;;;;;;;;AChED,CAAC;;AAED,eAAe,KAA6B,aAAa,SAAI,CAAC;AAC9D;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH,CAAC;;;;;;;;;;;;AC5DD;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,mBAAmB,cAAc;AACjC;AACA;AACA;AACA;AACA,0BAA0B,mBAAmB;AAC7C;AACA;AACA,aAAa;AACb,SAAS,iBAAiB,cAAc;AACxC;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,aAAa;AACb;AACA,aAAa;AACb,SAAS;AACT;AACA,SAAS;AACT;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB,aAAa;AACb;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;;AAEA,yCAAyC,0CAA0C;;AAEnF;AACA,yCAAyC,4CAA4C;AACrF;;AAEA;AACA;AACA;;AAEA;AACA;AACA,qCAAqC,8DAA8D;AACnG;AACA;AACA;AACA,qBAAqB;AACrB;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mBAAmB;AACnB,iBAAiB;;AAEjB;;AAEA,aAAa;AACb;AACA,aAAa;;AAEb;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,CAAC,a;;;;;;;;;;;AC1HD;AACA,gBAAgB,mBAAO,CAAC,oDAAS;AACjC,YAAY,mBAAO,CAAC,0EAAoB;AACxC,gBAAgB,mBAAO,CAAC,8EAAsB;AAC9C,eAAe,mBAAO,CAAC,0EAAoB;AAC3C,oBAAoB,mBAAO,CAAC,0EAAoB;AAChD,iBAAiB,mBAAO,CAAC,8EAAsB;AAC/C,iBAAiB,mBAAO,CAAC,8EAAsB;AAC/C,iBAAiB,mBAAO,CAAC,8EAAsB;AAC/C,aAAa,mBAAO,CAAC,gFAAuB;AAC5C,eAAe,mBAAO,CAAC,sFAA0B;AACjD,cAAc,mBAAO,CAAC,wEAAmB;AACzC,mBAAmB,mBAAO,CAAC,0DAAY;;AAEvC;;;AAGA;AACA;AACA;;AAEA,mCAAmC;AACnC,sCAAsC;;AAEtC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;;AAET;AACA;AACA,CAAC;;;;;;;;;;;;AC7ED;AACA,aAAa,mBAAO,CAAC,8DAAQ;;AAE7B,eAAe,mBAAO,CAAC,oEAAQ;;AAE/B;AACA;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,KAAK;;AAEL,CAAC;;;;;;;;;;;;AClCD;AACA;AACA;AACA,sCAAsC;AACtC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACfA;AACA;AACA;AACA,4BAA4B;AAC5B;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;;;;;;;;;;;;ACxBD;AACA,gBAAgB,mBAAO,CAAC,qDAAU;;AAElC,yBAAyB;AACzB,iCAAiC,kBAAkB;;AAEnD;AACA,2BAA2B,oBAAoB;AAC/C;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,sBAAsB,uBAAuB;AAC7C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA,SAAS;AACT;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA,CAAC;;;;;;;;;;;;AChFD;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACrBA;AACA,gBAAgB,mBAAO,CAAC,qDAAU;;AAElC;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yCAAyC,wCAAwC;AACjF;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,CAAC;;;;;;;;;;;;AC9BD;AACA,aAAa,mBAAO,CAAC,8DAAQ;;AAE7B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA,KAAK;AACL,CAAC;;;;;;;;;;;;ACrED;AACA,gBAAgB,mBAAO,CAAC,qDAAU;;AAElC;AACA;AACA;AACA;AACA;AACA,SAAS;AACT,wBAAwB,aAAa;AACrC;;AAEA;AACA;AACA;AACA;AACA;AACA,6BAA6B;AAC7B,6CAA6C;AAC7C;AACA;AACA;AACA,SAAS;AACT;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,gCAAgC,0EAA0E;AAC1G;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA,CAAC;;;;;;;;;;;;ACnDD;AACA,gBAAgB,mBAAO,CAAC,qDAAU;;AAElC;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA,aAAa;AACb,SAAS;AACT;;AAEA;AACA;AACA;AACA;AACA,oCAAoC,SAAS;AAC7C;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB;AACrB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb,SAAS;AACT;;AAEA;AACA;AACA;AACA,SAAS;AACT;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,yCAAyC,SAAS;AAClD;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;;AAEA;;AAEA;;AAEA,aAAa,mBAAO,CAAC,8DAAQ;;AAE7B;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;;;AAGL;AACA;AACA;AACA,2BAA2B;AAC3B,2BAA2B;AAC3B;AACA;AACA;AACA;;;AAGA,CAAC;;;;;;;;;;;;ACvLD;AACA,gBAAgB,mBAAO,CAAC,qDAAU;AAClC,eAAe,mBAAO,CAAC,8DAAQ;;AAE/B,yBAAyB;AACzB,iCAAiC,kBAAkB;;AAEnD;AACA;AACA,iDAAiD,aAAa;AAC9D;AACA,SAAS;AACT;;AAEA;AACA,oDAAoD,8BAA8B;AAClF,sBAAsB,iBAAiB;AACvC;AACA,oBAAoB,YAAY;AAChC;AACA;AACA;;AAEA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;;AAEA;AACA;AACA,uCAAuC,2EAA2E;AAClH;AACA;;AAEA;AACA;AACA,0FAA0F,GAAG,uBAAuB;AACpH,0CAA0C;AAC1C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,CAAC;;;;;;;;;;;;ACtDD;AACA,cAAc,mBAAO,CAAC,4CAAO;;AAE7B;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;;AAEA,8BAA8B;;AAE9B;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,6DAA6D;AAC7D;;AAEA;;AAEA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA,KAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gDAAgD;AAChD;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;;AAEA;;AAEA,CAAC;;;;;;;;;;;;AC5KD;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA,CAAC;;AAED;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA,EAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA,gBAAgB,WAAW;;AAE3B;;AAEA,GAAG;;AAEH;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA,IAAI;;AAEJ;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;;AAEA;;AAEA,mBAAmB,WAAW;;AAE9B;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA,KAAK;;AAEL;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA,YAAY;;AAEZ;;AAEA;;AAEA;;AAEA,EAAE;;AAEF;;AAEA;;AAEA,CAAC,EAAE,KAA0B,oE;;;;;;;;;;;;AChL7B;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,KAAK;AACL;AACA;AACA,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;;;;AAIA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,uBAAuB,sBAAsB;AAC7C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AAC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","file":"fhir-client.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./src/adapters/jquery.ts\");\n",";(function () {\n\n  var object =\n    typeof exports != 'undefined' ? exports :\n    typeof self != 'undefined' ? self : // #8: web workers\n    $.global; // #31: ExtendScript\n\n  var chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';\n\n  function InvalidCharacterError(message) {\n    this.message = message;\n  }\n  InvalidCharacterError.prototype = new Error;\n  InvalidCharacterError.prototype.name = 'InvalidCharacterError';\n\n  // encoder\n  // [https://gist.github.com/999166] by [https://github.com/nignag]\n  object.btoa || (\n  object.btoa = function (input) {\n    var str = String(input);\n    for (\n      // initialize result and counter\n      var block, charCode, idx = 0, map = chars, output = '';\n      // if the next str index does not exist:\n      //   change the mapping table to \"=\"\n      //   check if d has no fractional digits\n      str.charAt(idx | 0) || (map = '=', idx % 1);\n      // \"8 - idx % 1 * 8\" generates the sequence 2, 4, 6, 8\n      output += map.charAt(63 & block >> 8 - idx % 1 * 8)\n    ) {\n      charCode = str.charCodeAt(idx += 3/4);\n      if (charCode > 0xFF) {\n        throw new InvalidCharacterError(\"'btoa' failed: The string to be encoded contains characters outside of the Latin1 range.\");\n      }\n      block = block << 8 | charCode;\n    }\n    return output;\n  });\n\n  // decoder\n  // [https://gist.github.com/1020396] by [https://github.com/atk]\n  object.atob || (\n  object.atob = function (input) {\n    var str = String(input).replace(/[=]+$/, ''); // #31: ExtendScript bad parse of /=\n    if (str.length % 4 == 1) {\n      throw new InvalidCharacterError(\"'atob' failed: The string to be decoded is not correctly encoded.\");\n    }\n    for (\n      // initialize result and counters\n      var bc = 0, bs, buffer, idx = 0, output = '';\n      // get next character\n      buffer = str.charAt(idx++);\n      // character found in table? initialize bit storage and add its ascii value;\n      ~buffer && (bs = bc % 4 ? bs * 64 + buffer : buffer,\n        // and if not first of each 4 characters,\n        // convert the first 8 bits to one ascii character\n        bc++ % 4) ? output += String.fromCharCode(255 & bs >> (-2 * bc & 6)) : 0\n    ) {\n      // try to find character in table (0-63, not found => -1)\n      buffer = chars.indexOf(buffer);\n    }\n    return output;\n  });\n\n}());\n",";(function () {\n\n  var object = typeof exports != 'undefined' ? exports : this; // #8: web workers\n  var chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';\n\n  function InvalidCharacterError(message) {\n    this.message = message;\n  }\n  InvalidCharacterError.prototype = new Error;\n  InvalidCharacterError.prototype.name = 'InvalidCharacterError';\n\n  // encoder\n  // [https://gist.github.com/999166] by [https://github.com/nignag]\n  object.btoa || (\n  object.btoa = function (input) {\n    var str = String(input);\n    for (\n      // initialize result and counter\n      var block, charCode, idx = 0, map = chars, output = '';\n      // if the next str index does not exist:\n      //   change the mapping table to \"=\"\n      //   check if d has no fractional digits\n      str.charAt(idx | 0) || (map = '=', idx % 1);\n      // \"8 - idx % 1 * 8\" generates the sequence 2, 4, 6, 8\n      output += map.charAt(63 & block >> 8 - idx % 1 * 8)\n    ) {\n      charCode = str.charCodeAt(idx += 3/4);\n      if (charCode > 0xFF) {\n        throw new InvalidCharacterError(\"'btoa' failed: The string to be encoded contains characters outside of the Latin1 range.\");\n      }\n      block = block << 8 | charCode;\n    }\n    return output;\n  });\n\n  // decoder\n  // [https://gist.github.com/1020396] by [https://github.com/atk]\n  object.atob || (\n  object.atob = function (input) {\n    var str = String(input).replace(/=+$/, '');\n    if (str.length % 4 == 1) {\n      throw new InvalidCharacterError(\"'atob' failed: The string to be decoded is not correctly encoded.\");\n    }\n    for (\n      // initialize result and counters\n      var bc = 0, bs, buffer, idx = 0, output = '';\n      // get next character\n      buffer = str.charAt(idx++);\n      // character found in table? initialize bit storage and add its ascii value;\n      ~buffer && (bs = bc % 4 ? bs * 64 + buffer : buffer,\n        // and if not first of each 4 characters,\n        // convert the first 8 bits to one ascii character\n        bc++ % 4) ? output += String.fromCharCode(255 & bs >> (-2 * bc & 6)) : 0\n    ) {\n      // try to find character in table (0-63, not found => -1)\n      buffer = chars.indexOf(buffer);\n    }\n    return output;\n  });\n\n}());\n","(function() {\r\n    var fhirAPI;\r\n    var adapter;\r\n\r\n    function getNext (bundle, process) {\r\n        var i;\r\n        var d = bundle.data.entry || [];\r\n        var entries = [];\r\n        for (i = 0; i < d.length; i++) {\r\n            entries.push(d[i].resource);\r\n        }\r\n        process(entries);\r\n        var def = adapter.defer();\r\n        fhirAPI.nextPage({bundle:bundle.data}).then(function (r) {\r\n            getNext(r, process).then(function (t) {\r\n                def.resolve();\r\n            });\r\n        }, function(err) {def.resolve()});\r\n        return def.promise;\r\n    }\r\n    \r\n    function drain (searchParams, process, done, fail) {\r\n        var ret = adapter.defer();\r\n        \r\n        fhirAPI.search(searchParams).then(function(data){\r\n            getNext(data, process).then(function() {\r\n                done();\r\n            }, function(err) {\r\n                fail(err);\r\n            });\r\n        }, function(err) {\r\n            fail(err);\r\n        });\r\n    };\r\n    \r\n    function fetchAll (searchParams){\r\n        var ret = adapter.defer();\r\n        var results = [];\r\n        \r\n        drain(\r\n            searchParams,\r\n            function(entries) {\r\n                entries.forEach(function(entry) {\r\n                    results.push(entry);\r\n                });\r\n            },\r\n            function () {\r\n                ret.resolve(results);\r\n            },\r\n            function (err) {\r\n                ret.reject(err);\r\n            }\r\n        );\r\n          \r\n        return ret.promise;\r\n    };\r\n\r\n    function fetchAllWithReferences (searchParams, resolveParams) {\r\n        var ret = adapter.defer();\r\n          \r\n        fhirAPI.search(searchParams)  // TODO: THIS IS NOT CORRECT (need fetchAll, but it does not return a bundle yet)\r\n            .then(function(results){\r\n\r\n                var resolvedReferences = {};\r\n\r\n                var queue = [function() {ret.resolve(results, resolvedReferences);}];\r\n                \r\n                function enqueue (bundle,resource,reference) {\r\n                  queue.push(function() {resolveReference(bundle,resource,reference)});\r\n                }\r\n\r\n                function next() {\r\n                  (queue.pop())();\r\n                }\r\n\r\n                function resolveReference (bundle,resource,reference) {\r\n                    var referenceID = reference.reference;\r\n                    fhirAPI.resolve({'bundle': bundle, 'resource': resource, 'reference':reference}).then(function(res){\r\n                      var referencedObject = res.data || res.content;\r\n                      resolvedReferences[referenceID] = referencedObject;\r\n                      next();\r\n                    });\r\n                }\r\n\r\n                var bundle = results.data;\r\n\r\n                bundle.entry && bundle.entry.forEach(function(element){\r\n                  var resource = element.resource;\r\n                  var type = resource.resourceType;\r\n                  resolveParams && resolveParams.forEach(function(resolveParam){\r\n                    var param = resolveParam.split('.');\r\n                    var targetType = param[0];\r\n                    var targetElement = param[1];\r\n                    var reference = resource[targetElement];\r\n                    if (type === targetType && reference) {\r\n                      var referenceID = reference.reference;\r\n                      if (!resolvedReferences[referenceID]) {\r\n                        enqueue(bundle,resource,reference);\r\n                      }\r\n                    }\r\n                  });\r\n                });\r\n\r\n                next();\r\n\r\n            }, function(){\r\n                ret.reject(\"Could not fetch search results\");\r\n            });\r\n          \r\n        return ret.promise;\r\n    };\r\n    \r\n    function decorate (client, newAdapter) {\r\n        fhirAPI = client;\r\n        adapter = newAdapter;\r\n        client[\"drain\"] = drain;\r\n        client[\"fetchAll\"] = fetchAll;\r\n        client[\"fetchAllWithReferences\"] = fetchAllWithReferences;\r\n        return client;\r\n    }\r\n    \r\n    module.exports = decorate;\r\n}).call(this);","(function() {\n    var utils = require(\"./utils\");\n    var M = require('./middlewares/core');\n    var query = require('./middlewares/search');\n    var auth = require('./middlewares/auth');\n    var transport = require('./middlewares/http');\n    var errors = require('./middlewares/errors');\n    var config = require('./middlewares/config');\n    var bundle = require('./middlewares/bundle');\n    var pt = require('./middlewares/patient');\n    var refs = require('./middlewares/references');\n    var url = require('./middlewares/url');\n    var decorate = require('./decorate');\n\n    var cache = {};\n\n\n    var fhir = function(cfg, adapter){\n        var Middleware = M.Middleware;\n        var $$Attr = M.$$Attr;\n\n        var $$Method = function(m){ return $$Attr('method', m);};\n        var $$Header = function(h,v) {return $$Attr('headers.' + h, v);};\n\n        var $Errors = Middleware(errors);\n        var Defaults = Middleware(config(cfg, adapter))\n                .and($Errors)\n                .and(auth.$Basic)\n                .and(auth.$Bearer)\n                .and(auth.$Credentials)\n                .and(transport.$JsonData)\n                .and($$Header('Accept', (cfg.headers && cfg.headers['Accept']) ? cfg.headers['Accept'] : 'application/json'))\n                .and($$Header('Content-Type', (cfg.headers && cfg.headers['Content-Type']) ? cfg.headers['Content-Type'] : 'application/json'));\n\n        var GET = Defaults.and($$Method('GET'));\n        var POST = Defaults.and($$Method('POST'));\n        var PUT = Defaults.and($$Method('PUT'));\n        var DELETE = Defaults.and($$Method('DELETE'));\n\n        var http = transport.Http(cfg, adapter);\n\n        var Path = url.Path;\n        var BaseUrl = Path(cfg.baseUrl);\n        var resourceTypePath = BaseUrl.slash(\":type || :resource.resourceType\");\n        var searchPath = resourceTypePath;\n        var resourceTypeHxPath = resourceTypePath.slash(\"_history\");\n        var resourcePath = resourceTypePath.slash(\":id || :resource.id\");\n        var resourceHxPath = resourcePath.slash(\"_history\");\n        var vreadPath =  resourceHxPath.slash(\":versionId || :resource.meta.versionId\");\n        var resourceVersionPath = resourceHxPath.slash(\":versionId || :resource.meta.versionId\");\n\n        var ReturnHeader = $$Header('Prefer', 'return=representation');\n\n        var $Paging = Middleware(query.$Paging);\n\n        return decorate({\n            conformance: GET.and(BaseUrl.slash(\"metadata\")).end(http),\n            document: POST.and(BaseUrl.slash(\"Document\")).end(http),\n            profile:  GET.and(BaseUrl.slash(\"Profile\").slash(\":type\")).end(http),\n            transaction: POST.and(BaseUrl).end(http),\n            history: GET.and(BaseUrl.slash(\"_history\")).and($Paging).end(http),\n            typeHistory: GET.and(resourceTypeHxPath).and($Paging).end(http),\n            resourceHistory: GET.and(resourceHxPath).and($Paging).end(http),\n            read: GET.and(pt.$WithPatient).and(resourcePath).end(http),\n            vread: GET.and(vreadPath).end(http),\n            \"delete\": DELETE.and(resourcePath).and(ReturnHeader).end(http),\n            create: POST.and(resourceTypePath).and(ReturnHeader).end(http),\n            validate: POST.and(resourceTypePath.slash(\"_validate\")).end(http),\n            search: GET.and(resourceTypePath).and(pt.$WithPatient).and(query.$SearchParams).and($Paging).end(http),\n            update: PUT.and(resourcePath).and(ReturnHeader).end(http),\n            nextPage: GET.and(bundle.$$BundleLinkUrl(\"next\")).end(http),\n            prevPage: GET.and(bundle.$$BundleLinkUrl(\"prev\")).end(http),\n            resolve: GET.and(refs.resolve).end(http)\n        }, adapter);\n\n    };\n    module.exports = fhir;\n}).call(this);\n","(function() {\n    var mw = require('./core');\n\n    var btoa = require('Base64').btoa;\n\n    exports.$Basic = mw.$$Attr('headers.Authorization', function(args){\n        if(args.auth && args.auth.user && args.auth.pass){\n            return \"Basic \" + btoa(args.auth.user + \":\" + args.auth.pass);\n        }\n    });\n\n    exports.$Bearer = mw.$$Attr('headers.Authorization', function(args){\n        if(args.auth && args.auth.bearer){\n            return \"Bearer \" + args.auth.bearer;\n        }\n    });\n\n    var credentials;\n    // this first middleware sets the credentials attribute to empty, so\n    // adapters cannot use it directly, thus enforcing a valid value to be parsed in.\n    exports.$Credentials = mw.Middleware(mw.$$Attr('credentials', function(args){\n      // Assign value for later checking\n      credentials = args.credentials\n\n      // Needs to return non-null and not-undefined\n      // in order for value to be (un)set\n      return '';\n    })).and(mw.$$Attr('credentials', function(args){\n        // check credentials for valid options, valid for fetch\n        if(['same-origin', 'include'].indexOf(credentials) > -1 ){\n            return credentials;\n        }\n    }));\n\n}).call(this);\n","exports.$$BundleLinkUrl =  function(rel){\n    return function(h) {\n        return function(args){\n            var matched = function(x){return x.relation && x.relation === rel;};\n            var res =  args.bundle && (args.bundle.link || []).filter(matched)[0];\n            if(res && res.url){\n                args.url = res.url;\n                args.data = null;\n                return h(args);\n            }\n            else{\n                throw new Error(\"No \" + rel + \" link found in bundle\");\n            }\n        };\n    };\n};\n","(function() {\n    var copyAttr = function(from, to, attr){\n        var v =  from[attr];\n        if(v && !to[attr]) {to[attr] = v;}\n        return from;\n    };\n\n    module.exports = function(cfg, adapter){\n        return function(h){\n            return function(args){\n                copyAttr(cfg, args, 'baseUrl');\n                copyAttr(cfg, args, 'cache');\n                copyAttr(cfg, args, 'auth');\n                copyAttr(cfg, args, 'patient');\n                copyAttr(cfg, args, 'debug');\n                copyAttr(cfg, args, 'credentials');\n                copyAttr(cfg, args, 'headers');\n                copyAttr(cfg, args, 'agentOptions');\n                copyAttr(adapter, args, 'defer');\n                copyAttr(adapter, args, 'http');\n                return h(args);\n            };\n        };\n    };\n}).call(this);\n","(function() {\n    var utils = require(\"../utils\");\n\n    var id = function(x){return x;};\n    var constantly = function(x){return function(){return x;};};\n\n    var mwComposition = function(mw1, mw2){\n        return function(h){ return mw1(mw2(h)); };\n    };\n\n    var Middleware = function(mw){\n        mw.and = function(nmw){\n            return Middleware(mwComposition(mw, nmw));\n        };\n        mw.end = function(h){\n            return mw(h);\n        };\n        return mw;\n    };\n\n    // generate wm from function\n    exports.$$Simple = function(f){\n        return function(h){\n            return function(args){\n                return h(f(args));\n            };\n        };\n    };\n\n    var setAttr = function(args, attr, value){\n        var path = attr.split('.');\n        var obj = args;\n        for(var i = 0; i < (path.length - 1); i++){\n            var k = path[i];\n            obj = args[k];\n            if(!obj){\n                obj = {};\n                args[k] = obj;\n            }\n        }\n        obj[path[path.length - 1]] = value;\n        return args;\n    };\n\n    // generate wm from function\n    exports.$$Attr = function(attr, fn){\n        return Middleware(function(h){\n            return function(args) {\n                var value = null;\n                if(utils.type(fn) == 'function'){\n                   value = fn(args);\n                } else {\n                    value = fn;\n                }\n                if(value == null && value == undefined){\n                    return h(args);\n                }else {\n                    return h(setAttr(args, attr, value));\n                }\n            };\n        });\n    };\n\n    var Attribute = function(attr, fn){\n        return Middleware(function(h){\n            return function(args) {\n                args[attr] = fn(args);\n                return h(args);\n            };\n        });\n    };\n\n    var Method = function(method){\n        return Attribute('method', constantly(method));\n    };\n\n    exports.Middleware = Middleware;\n    exports.Attribute = Attribute;\n    exports.Method = Method;\n\n}).call(this);\n","module.exports = function(h){\n    return function(args){\n        try{\n            return h(args);\n        }catch(e){\n            if(args.debug){\n               console.log(\"\\nDEBUG: (ERROR in middleware)\");\n               console.log(e.message);\n               console.log(e.stack);\n            }\n            if(!args.defer) {\n                console.log(\"\\nDEBUG: (ERROR in middleware)\");\n                console.log(e.message);\n                console.log(e.stack);\n                throw new Error(\"I need adapter.defer\");\n            }\n            var deff = args.defer();\n            deff.reject(e);\n            return deff.promise;\n        }\n    };\n};\n","(function() {\n    var utils = require(\"../utils\");\n\n    exports.Http = function(cfg, adapter){\n        return function(args){\n            if(args.debug){\n                console.log(\"\\nDEBUG (request):\", args.method, args.url, args);\n            }\n            var promise = (args.http || adapter.http  || cfg.http)(args);\n            if (args.debug && promise && promise.then){\n                promise.then(function(x){ console.log(\"\\nDEBUG: (responce)\", x);});\n            }\n            return promise;\n        };\n    };\n\n    var toJson = function(x){\n        return (utils.type(x) == 'object') ? JSON.stringify(x) : x;\n    };\n\n    exports.$JsonData = function(h){\n        return function(args){\n            var data = args.bundle || args.data || args.resource;\n            if(data){\n                args.data = toJson(data);\n            }\n            return h(args);\n        };\n    };\n\n}).call(this);\n","(function() {\n    var mw = require('./core');\n\n    // List of resources with 'patient' or 'subject' properties (as of FHIR DSTU2 1.0.0)\n    var targets = [\n        \"Account\",\n        \"AllergyIntolerance\",\n        \"BodySite\",\n        \"CarePlan\",\n        \"Claim\",\n        \"ClinicalImpression\",\n        \"Communication\",\n        \"CommunicationRequest\",\n        \"Composition\",\n        \"Condition\",\n        \"Contract\",\n        \"DetectedIssue\",\n        \"Device\",\n        \"DeviceUseRequest\",\n        \"DeviceUseStatement\",\n        \"DiagnosticOrder\",\n        \"DiagnosticReport\",\n        \"DocumentManifest\",\n        \"DocumentReference\",\n        \"Encounter\",\n        \"EnrollmentRequest\",\n        \"EpisodeOfCare\",\n        \"FamilyMemberHistory\",\n        \"Flag\",\n        \"Goal\",\n        \"ImagingObjectSelection\",\n        \"ImagingStudy\",\n        \"Immunization\",\n        \"ImmunizationRecommendation\",\n        \"List\",\n        \"Media\",\n        \"MedicationAdministration\",\n        \"MedicationDispense\",\n        \"MedicationOrder\",\n        \"MedicationStatement\",\n        \"NutritionOrder\",\n        \"Observation\",\n        \"Order\",\n        \"Procedure\",\n        \"ProcedureRequest\",\n        \"QuestionnaireResponse\",\n        \"ReferralRequest\",\n        \"RelatedPerson\",\n        \"RiskAssessment\",\n        \"Specimen\",\n        \"SupplyDelivery\",\n        \"SupplyRequest\",\n        \"VisionPrescription\"\n    ];\n\n    exports.$WithPatient = mw.$$Simple(function(args){\n        var type = args.type;\n        if (args.patient) {\n            if (type === \"Patient\") {\n                args.query = args.query || {};\n                args.query[\"_id\"] = args.patient;\n                args[\"id\"] = args.patient;\n            } else if (targets.indexOf(type) >= 0){\n                args.query = args.query || {};\n                args.query[\"patient\"] = args.patient;\n            }\n        }\n        return args;\n    });\n}).call(this);\n","(function() {\n    var utils = require('../utils');\n\n    var CONTAINED = /^#(.*)/;\n    var resolveContained = function(ref, resource) {\n        var cid = ref.match(CONTAINED)[1];\n        var ret = (resource.contained || []).filter(function(r){\n            return (r.id || r._id) == cid;\n        })[0];\n        return (ret && {content: ret}) || null;\n    };\n\n    var sync = function(arg) {\n        var cache = arg.cache;\n        var reference = arg.reference;\n        var bundle = arg.bundle;\n        var ref = reference;\n        if (!ref.reference) {return null;}\n        if (ref.reference.match(CONTAINED)) {return resolveContained(ref.reference, arg.resource);}\n        var abs = utils.absoluteUrl(arg.baseUrl, ref.reference);\n        var bundled = ((bundle && bundle.entry) || []).filter( function(e){\n            return e.id === abs;\n        })[0];\n        return bundled || (cache != null ? cache[abs] : void 0) || null;\n    };\n\n    var resolve = function(h){\n        return function(args) {\n            var cacheMatched = sync(args);\n            var ref = args.reference;\n            var def = args.defer();\n            if (cacheMatched) {\n                if(!args.defer){ throw new Error(\"I need promise constructor 'adapter.defer' in adapter\"); }\n                def.resolve(cacheMatched);\n                return def.promise;\n            }\n            if (!ref) {\n                throw new Error(\"No reference found\");\n            }\n            if (ref && ref.reference.match(CONTAINED)) {\n                throw new Error(\"Contained resource not found\");\n            }\n            args.url = utils.absoluteUrl(args.baseUrl, ref.reference);\n            args.data = null;\n            return h(args);\n        };\n    };\n\n    module.exports.sync = sync;\n    module.exports.resolve = resolve;\n\n}).call(this);\n","(function() {\n    var utils = require('../utils');\n\n    var type = utils.type;\n\n    var assertArray = utils.assertArray;\n\n    var assertObject = utils.assertObject;\n\n    var reduceMap = utils.reduceMap;\n\n    var identity = utils.identity;\n\n    var OPERATORS = {\n        $gt: 'gt',\n        $lt: 'lt',\n        $lte: 'lte',\n        $gte: 'gte'\n    };\n\n    var MODIFIERS = {\n        $asc: ':asc',\n        $desc: ':desc',\n        $exact: ':exact',\n        $missing: ':missing',\n        $null: ':missing',\n        $text: ':text'\n    };\n\n    var isOperator = function(v) {\n        return v.indexOf('$') === 0;\n    };\n\n    var expandParam = function(k, v) {\n        return reduceMap(v, function(acc, arg) {\n            var kk, o, res, vv;\n            kk = arg[0], vv = arg[1];\n            return acc.concat(kk === '$and' ? assertArray(vv).reduce((function(a, vvv) {\n                return a.concat(linearizeOne(k, vvv));\n            }), []) : kk === '$type' ? [] : isOperator(kk) ? (o = {\n                param: k\n            }, kk === '$or' ? o.value = vv : (OPERATORS[kk] ? o.operator = OPERATORS[kk] : void 0, MODIFIERS[kk] ? o.modifier = MODIFIERS[kk] : void 0, type(vv) === 'object' && vv.$or ? o.value = vv.$or : o.value = [vv]), [o]) : (v.$type ? res = \":\" + v.$type : void 0, linearizeOne(\"\" + k + (res || '') + \".\" + kk, vv)));\n        });\n    };\n\n    var handleSort = function(xs) {\n        var i, len, results, x;\n        assertArray(xs);\n        results = [];\n        for (i = 0, len = xs.length; i < len; i++) {\n            x = xs[i];\n            switch (type(x)) {\n            case 'array':\n                results.push({\n                    param: '_sort',\n                    value: x[0],\n                    modifier: \":\" + x[1]\n                });\n                break;\n            case 'string':\n                results.push({\n                    param: '_sort',\n                    value: x\n                });\n                break;\n            default:\n                results.push(void 0);\n            }\n        }\n        return results;\n    };\n\n    var handleInclude = function(includes) {\n        return reduceMap(includes, function(acc, arg) {\n            var k, v;\n            k = arg[0], v = arg[1];\n            return acc.concat((function() {\n                switch (type(v)) {\n                case 'array':\n                    return v.map(function(x) {\n                        return {\n                            param: '_include',\n                            value: k + \".\" + x\n                        };\n                    });\n                case 'string':\n                    return [\n                        {\n                            param: '_include',\n                            value: k + \".\" + v\n                        }\n                    ];\n                }\n            })());\n        });\n    };\n\n    var linearizeOne = function(k, v) {\n        if (k === '$sort') {\n            return handleSort(v);\n        } else if (k === '$include') {\n            return handleInclude(v);\n        } else {\n            switch (type(v)) {\n            case 'object':\n                return expandParam(k, v);\n            case 'string':\n                return [\n                    {\n                        param: k,\n                        value: [v]\n                    }\n                ];\n            case 'number':\n                return [\n                    {\n                        param: k,\n                        value: [v]\n                    }\n                ];\n            case 'array':\n                return [\n                    {\n                        param: k,\n                        value: [v.join(\"|\")]\n                    }\n                ];\n            default:\n                throw \"could not linearizeParams \" + (type(v));\n            }\n        }\n    };\n\n    var linearizeParams = function(query) {\n        return reduceMap(query, function(acc, arg) {\n            var k, v;\n            k = arg[0], v = arg[1];\n            return acc.concat(linearizeOne(k, v));\n        });\n    };\n\n    var buildSearchParams = function(query) {\n        var p, ps;\n        ps = (function() {\n            var i, len, ref, results;\n            ref = linearizeParams(query);\n            results = [];\n            for (i = 0, len = ref.length; i < len; i++) {\n                p = ref[i];\n                results.push([p.param, p.modifier, '=', p.operator, encodeURIComponent(p.value)].filter(identity).join(''));\n            }\n            return results;\n        })();\n        return ps.join(\"&\");\n    };\n\n    exports._query = linearizeParams;\n\n    exports.query = buildSearchParams;\n\n    var mw = require('./core');\n\n    exports.$SearchParams = mw.$$Attr('url', function(args){\n        var url = args.url;\n        if(args.query){\n             var queryStr = buildSearchParams(args.query);\n             return url + \"?\" + queryStr;\n        }\n        return url;\n    });\n\n\n    exports.$Paging = function(h){\n        return function(args){\n            var params = args.params || {};\n            if(args.since){params._since = args.since;}\n            if(args.count){params._count = args.count;}\n            args.params = params;\n            return h(args);\n        };\n    };\n\n\n}).call(this);\n","(function() {\n    var utils = require(\"../utils\");\n    var core = require(\"./core\");\n\n    var id = function(x){return x;};\n    var constantly = function(x){return function(){return x;};};\n\n    var get_in = function(obj, path){\n        return path.split('.').reduce(function(acc,x){\n            if(acc == null || acc == undefined) { return null; }\n            return acc[x];\n        }, obj);\n    };\n\n    var evalPropsExpr = function(exp, args){\n        var exps =  exp.split('||').map(function(x){return x.trim().substring(1);});\n        for(var i = 0; i < exps.length; i++){\n            var res = get_in(args, exps[i]);\n            if(res){ return res; }\n        }\n        return null;\n    };\n\n    var evalExpr = function(exp, args){\n        if (exp.indexOf(\":\") == 0){\n            return evalPropsExpr(exp, args);\n        } else {\n            return exp;\n        }\n    };\n\n    var buildPathPart = function(pth, args){\n        var k = evalExpr(pth.trim(), args);\n        if(k==null || k === undefined){ throw new Error(\"Parameter \"+pth+\" is required: \" + JSON.stringify(args)); }\n        return k;\n    };\n\n    // path chaining function\n    // which return haldler wrapper: (h, cfg)->(args -> promise)\n    // it's chainable Path(\"baseUrl\").slash(\":type\").slash(\":id\").slash(\"_history\")(id, {})({id: 5, type: 'Patient'})\n    // and composable p0 = Path(\"baseUrl); p1 = p0.slash(\"path)\n    var Path = function(tkn, chain){\n        //Chainable\n        var new_chain = function(args){\n            return ((chain && (chain(args) + \"/\")) || \"\") +  buildPathPart(tkn, args);\n        };\n        var ch = core.Attribute('url', new_chain);\n        ch.slash = function(tkn){\n            return Path(tkn, new_chain);\n        };\n        return ch;\n    };\n\n    exports.Path = Path;\n}).call(this);\n","(function() {\n  var merge = require('merge');\n\n  var RTRIM = /^[\\s\\uFEFF\\xA0]+|[\\s\\uFEFF\\xA0]+$/g;\n\n  var trim = function(text) {\n    return text ? text.toString().replace(RTRIM, \"\")  : \"\";\n  };\n\n  exports.trim = trim;\n\n  var addKey = function(acc, str) {\n    var pair, val;\n    if (!str) {\n      return null;\n    }\n    pair = str.split(\"=\").map(trim);\n    val = pair[1].replace(/(^\"|\"$)/g, '');\n    if (val) {\n      acc[pair[0]] = val;\n    }\n    return acc;\n  };\n\n  var type = function(obj) {\n    var classToType;\n    if (obj == null && obj === undefined) {\n      return String(obj);\n    }\n    classToType = {\n      '[object Boolean]': 'boolean',\n      '[object Number]': 'number',\n      '[object String]': 'string',\n      '[object Function]': 'function',\n      '[object Array]': 'array',\n      '[object Date]': 'date',\n      '[object RegExp]': 'regexp',\n      '[object Object]': 'object'\n    };\n    return classToType[Object.prototype.toString.call(obj)];\n  };\n\n  exports.type = type;\n\n  var assertArray = function(a) {\n    if (type(a) !== 'array') {\n      throw 'not array';\n    }\n    return a;\n  };\n\n  exports.assertArray = assertArray;\n\n  var assertObject = function(a) {\n    if (type(a) !== 'object') {\n      throw 'not object';\n    }\n    return a;\n  };\n\n  exports.assertObject = assertObject;\n\n  var reduceMap = function(m, fn, acc) {\n    var k, v;\n    acc || (acc = []);\n    assertObject(m);\n    return ((function() {\n      var results;\n      results = [];\n      for (k in m) {\n        v = m[k];\n        results.push([k, v]);\n      }\n      return results;\n    })()).reduce(fn, acc);\n  };\n\n  exports.reduceMap = reduceMap;\n\n  var identity = function(x) {return x;};\n\n  exports.identity = identity;\n\n  var argsArray = function() {\n     return Array.prototype.slice.call(arguments)\n  };\n\n  exports.argsArray = argsArray;\n\n  var mergeLists = function() {\n    var reduce;\n    reduce = function(merged, nextMap) {\n      var k, ret, v;\n      ret = merge(true, merged);\n      for (k in nextMap) {\n        v = nextMap[k];\n        ret[k] = (ret[k] || []).concat(v);\n      }\n      return ret;\n    };\n    return argsArray.apply(null, arguments).reduce(reduce, {});\n  };\n\n  exports.mergeLists = mergeLists;\n\n  var absoluteUrl = function(baseUrl, ref) {\n    if (!ref.match(/https?:\\/\\/./)) {\n      return baseUrl + \"/\" + ref;\n    } else {\n      return ref;\n    }\n  };\n\n  exports.absoluteUrl = absoluteUrl;\n\n  var relativeUrl = function(baseUrl, ref) {\n    if (ref.slice(ref, baseUrl.length + 1) === baseUrl + \"/\") {\n      return ref.slice(baseUrl.length + 1);\n    } else {\n      return ref;\n    }\n  };\n\n  exports.relativeUrl = relativeUrl;\n\n  exports.resourceIdToUrl = function(id, baseUrl, type) {\n    baseUrl = baseUrl.replace(/\\/$/, '');\n    id = id.replace(/^\\//, '');\n    if (id.indexOf('/') < 0) {\n      return baseUrl + \"/\" + type + \"/\" + id;\n    } else if (id.indexOf(baseUrl) !== 0) {\n      return baseUrl + \"/\" + id;\n    } else {\n      return id;\n    }\n  };\n\n  var walk = function(inner, outer, data, context) {\n    var keysToMap, remapped;\n    switch (type(data)) {\n      case 'array':\n        return outer(data.map(function(item) {\n          return inner(item, [data, context]);\n        }), context);\n      case 'object':\n        keysToMap = function(acc, arg) {\n          var k, v;\n          k = arg[0], v = arg[1];\n          acc[k] = inner(v, [data].concat(context));\n          return acc;\n        };\n        remapped = reduceMap(data, keysToMap, {});\n        return outer(remapped, context);\n      default:\n        return outer(data, context);\n    }\n  };\n\n  exports.walk = walk;\n\n  var postwalk = function(f, data, context) {\n    if (!data) {\n      return function(data, context) {\n        return postwalk(f, data, context);\n      };\n    } else {\n      return walk(postwalk(f), f, data, context);\n    }\n  };\n\n  exports.postwalk = postwalk;\n\n}).call(this);\n","/*!\r\n * @name JavaScript/NodeJS Merge v1.2.1\r\n * @author yeikos\r\n * @repository https://github.com/yeikos/js.merge\r\n\r\n * Copyright 2014 yeikos - MIT license\r\n * https://raw.github.com/yeikos/js.merge/master/LICENSE\r\n */\r\n\r\n;(function(isNode) {\r\n\r\n\t/**\r\n\t * Merge one or more objects \r\n\t * @param bool? clone\r\n\t * @param mixed,... arguments\r\n\t * @return object\r\n\t */\r\n\r\n\tvar Public = function(clone) {\r\n\r\n\t\treturn merge(clone === true, false, arguments);\r\n\r\n\t}, publicName = 'merge';\r\n\r\n\t/**\r\n\t * Merge two or more objects recursively \r\n\t * @param bool? clone\r\n\t * @param mixed,... arguments\r\n\t * @return object\r\n\t */\r\n\r\n\tPublic.recursive = function(clone) {\r\n\r\n\t\treturn merge(clone === true, true, arguments);\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Clone the input removing any reference\r\n\t * @param mixed input\r\n\t * @return mixed\r\n\t */\r\n\r\n\tPublic.clone = function(input) {\r\n\r\n\t\tvar output = input,\r\n\t\t\ttype = typeOf(input),\r\n\t\t\tindex, size;\r\n\r\n\t\tif (type === 'array') {\r\n\r\n\t\t\toutput = [];\r\n\t\t\tsize = input.length;\r\n\r\n\t\t\tfor (index=0;index<size;++index)\r\n\r\n\t\t\t\toutput[index] = Public.clone(input[index]);\r\n\r\n\t\t} else if (type === 'object') {\r\n\r\n\t\t\toutput = {};\r\n\r\n\t\t\tfor (index in input)\r\n\r\n\t\t\t\toutput[index] = Public.clone(input[index]);\r\n\r\n\t\t}\r\n\r\n\t\treturn output;\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Merge two objects recursively\r\n\t * @param mixed input\r\n\t * @param mixed extend\r\n\t * @return mixed\r\n\t */\r\n\r\n\tfunction merge_recursive(base, extend) {\r\n\r\n\t\tif (typeOf(base) !== 'object')\r\n\r\n\t\t\treturn extend;\r\n\r\n\t\tfor (var key in extend) {\r\n\r\n\t\t\tif (typeOf(base[key]) === 'object' && typeOf(extend[key]) === 'object') {\r\n\r\n\t\t\t\tbase[key] = merge_recursive(base[key], extend[key]);\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tbase[key] = extend[key];\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn base;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Merge two or more objects\r\n\t * @param bool clone\r\n\t * @param bool recursive\r\n\t * @param array argv\r\n\t * @return object\r\n\t */\r\n\r\n\tfunction merge(clone, recursive, argv) {\r\n\r\n\t\tvar result = argv[0],\r\n\t\t\tsize = argv.length;\r\n\r\n\t\tif (clone || typeOf(result) !== 'object')\r\n\r\n\t\t\tresult = {};\r\n\r\n\t\tfor (var index=0;index<size;++index) {\r\n\r\n\t\t\tvar item = argv[index],\r\n\r\n\t\t\t\ttype = typeOf(item);\r\n\r\n\t\t\tif (type !== 'object') continue;\r\n\r\n\t\t\tfor (var key in item) {\r\n\r\n\t\t\t\tif (key === '__proto__') continue;\r\n\r\n\t\t\t\tvar sitem = clone ? Public.clone(item[key]) : item[key];\r\n\r\n\t\t\t\tif (recursive) {\r\n\r\n\t\t\t\t\tresult[key] = merge_recursive(result[key], sitem);\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tresult[key] = sitem;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Get type of variable\r\n\t * @param mixed input\r\n\t * @return string\r\n\t *\r\n\t * @see http://jsperf.com/typeofvar\r\n\t */\r\n\r\n\tfunction typeOf(input) {\r\n\r\n\t\treturn ({}).toString.call(input).slice(8, -1).toLowerCase();\r\n\r\n\t}\r\n\r\n\tif (isNode) {\r\n\r\n\t\tmodule.exports = Public;\r\n\r\n\t} else {\r\n\r\n\t\twindow[publicName] = Public;\r\n\r\n\t}\r\n\r\n})(typeof module === 'object' && module && typeof module.exports === 'object' && module.exports);","// shim for using process in browser\nvar process = module.exports = {};\n\n// cached from whatever global is present so that test runners that stub it\n// don't break things.  But we need to wrap it in a try catch in case it is\n// wrapped in strict mode code which doesn't define any globals.  It's inside a\n// function because try/catches deoptimize in certain engines.\n\nvar cachedSetTimeout;\nvar cachedClearTimeout;\n\nfunction defaultSetTimout() {\n    throw new Error('setTimeout has not been defined');\n}\nfunction defaultClearTimeout () {\n    throw new Error('clearTimeout has not been defined');\n}\n(function () {\n    try {\n        if (typeof setTimeout === 'function') {\n            cachedSetTimeout = setTimeout;\n        } else {\n            cachedSetTimeout = defaultSetTimout;\n        }\n    } catch (e) {\n        cachedSetTimeout = defaultSetTimout;\n    }\n    try {\n        if (typeof clearTimeout === 'function') {\n            cachedClearTimeout = clearTimeout;\n        } else {\n            cachedClearTimeout = defaultClearTimeout;\n        }\n    } catch (e) {\n        cachedClearTimeout = defaultClearTimeout;\n    }\n} ())\nfunction runTimeout(fun) {\n    if (cachedSetTimeout === setTimeout) {\n        //normal enviroments in sane situations\n        return setTimeout(fun, 0);\n    }\n    // if setTimeout wasn't available but was latter defined\n    if ((cachedSetTimeout === defaultSetTimout || !cachedSetTimeout) && setTimeout) {\n        cachedSetTimeout = setTimeout;\n        return setTimeout(fun, 0);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedSetTimeout(fun, 0);\n    } catch(e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't trust the global object when called normally\n            return cachedSetTimeout.call(null, fun, 0);\n        } catch(e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error\n            return cachedSetTimeout.call(this, fun, 0);\n        }\n    }\n\n\n}\nfunction runClearTimeout(marker) {\n    if (cachedClearTimeout === clearTimeout) {\n        //normal enviroments in sane situations\n        return clearTimeout(marker);\n    }\n    // if clearTimeout wasn't available but was latter defined\n    if ((cachedClearTimeout === defaultClearTimeout || !cachedClearTimeout) && clearTimeout) {\n        cachedClearTimeout = clearTimeout;\n        return clearTimeout(marker);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedClearTimeout(marker);\n    } catch (e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't  trust the global object when called normally\n            return cachedClearTimeout.call(null, marker);\n        } catch (e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error.\n            // Some versions of I.E. have different rules for clearTimeout vs setTimeout\n            return cachedClearTimeout.call(this, marker);\n        }\n    }\n\n\n\n}\nvar queue = [];\nvar draining = false;\nvar currentQueue;\nvar queueIndex = -1;\n\nfunction cleanUpNextTick() {\n    if (!draining || !currentQueue) {\n        return;\n    }\n    draining = false;\n    if (currentQueue.length) {\n        queue = currentQueue.concat(queue);\n    } else {\n        queueIndex = -1;\n    }\n    if (queue.length) {\n        drainQueue();\n    }\n}\n\nfunction drainQueue() {\n    if (draining) {\n        return;\n    }\n    var timeout = runTimeout(cleanUpNextTick);\n    draining = true;\n\n    var len = queue.length;\n    while(len) {\n        currentQueue = queue;\n        queue = [];\n        while (++queueIndex < len) {\n            if (currentQueue) {\n                currentQueue[queueIndex].run();\n            }\n        }\n        queueIndex = -1;\n        len = queue.length;\n    }\n    currentQueue = null;\n    draining = false;\n    runClearTimeout(timeout);\n}\n\nprocess.nextTick = function (fun) {\n    var args = new Array(arguments.length - 1);\n    if (arguments.length > 1) {\n        for (var i = 1; i < arguments.length; i++) {\n            args[i - 1] = arguments[i];\n        }\n    }\n    queue.push(new Item(fun, args));\n    if (queue.length === 1 && !draining) {\n        runTimeout(drainQueue);\n    }\n};\n\n// v8 likes predictible objects\nfunction Item(fun, array) {\n    this.fun = fun;\n    this.array = array;\n}\nItem.prototype.run = function () {\n    this.fun.apply(null, this.array);\n};\nprocess.title = 'browser';\nprocess.browser = true;\nprocess.env = {};\nprocess.argv = [];\nprocess.version = ''; // empty string to avoid regexp issues\nprocess.versions = {};\n\nfunction noop() {}\n\nprocess.on = noop;\nprocess.addListener = noop;\nprocess.once = noop;\nprocess.off = noop;\nprocess.removeListener = noop;\nprocess.removeAllListeners = noop;\nprocess.emit = noop;\nprocess.prependListener = noop;\nprocess.prependOnceListener = noop;\n\nprocess.listeners = function (name) { return [] }\n\nprocess.binding = function (name) {\n    throw new Error('process.binding is not supported');\n};\n\nprocess.cwd = function () { return '/' };\nprocess.chdir = function (dir) {\n    throw new Error('process.chdir is not supported');\n};\nprocess.umask = function() { return 0; };\n","/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\nthis file except in compliance with the License. You may obtain a copy of the\r\nLicense at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\nMERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\nSee the Apache Version 2.0 License for specific language governing permissions\r\nand limitations under the License.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) if (e.indexOf(p[i]) < 0)\r\n            t[p[i]] = s[p[i]];\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport function __exportStar(m, exports) {\r\n    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];\r\n}\r\n\r\nexport function __values(o) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator], i = 0;\r\n    if (m) return m.call(o);\r\n    return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\r\n    result.default = mod;\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n","module.exports = function(module) {\n\tif (!module.webpackPolyfill) {\n\t\tmodule.deprecate = function() {};\n\t\tmodule.paths = [];\n\t\t// module.parent = undefined by default\n\t\tif (!module.children) module.children = [];\n\t\tObject.defineProperty(module, \"loaded\", {\n\t\t\tenumerable: true,\n\t\t\tget: function() {\n\t\t\t\treturn module.l;\n\t\t\t}\n\t\t});\n\t\tObject.defineProperty(module, \"id\", {\n\t\t\tenumerable: true,\n\t\t\tget: function() {\n\t\t\t\treturn module.i;\n\t\t\t}\n\t\t});\n\t\tmodule.webpackPolyfill = 1;\n\t}\n\treturn module;\n};\n","import { FhirClient as NS } from \"..\";\nimport Adapter              from \"./adapter\";\n// import makeFhir             from \"fhir.js\";\nimport makeFhir             from \"fhir.js/src/fhir.js\";\nimport { urlToAbsolute, getPath } from \"./lib\";\n\n/**\n * A SMART Client instance will simplify some tasks for you. It will authorize\n * requests automatically, use refresh tokens, handle errors and so on.\n */\nexport default class Client\n{\n    /**\n     * The serialized state as it is stored in the session (or other storage).\n     * Contains things like tokens, client secrets, settings and so on.\n     */\n    protected state: NS.ClientState;\n\n    protected fhirJs: any;\n\n    constructor(state: NS.ClientState)\n    {\n        // This might happen if the state have been lost (for example the\n        // sessionStorage has been cleared, size limit exceeded etc.).\n        if (!state) {\n            throw new Error(\"No state provided to the client\");\n        }\n        this.state = state;\n\n        const accessToken = getPath(this.state, \"tokenResponse.access_token\");\n\n        this.fhirJs = makeFhir({\n            baseUrl: state.serverUrl,\n            auth: accessToken ?\n                { bearer: accessToken } :\n                {}\n        });\n    }\n\n    /**\n     * Allows you to do the following:\n     * 1. Use relative URLs (treat them as relative to the \"serverUrl\" option)\n     * 2. Automatically authorize requests with your accessToken (if any)\n     * 3. Automatically re-authorize using the refreshToken (if available)\n     * 4. Automatically parse error operation outcomes and turn them into\n     *   JavaScript Error objects with which the resulting promises are rejected\n     * @param {object|string} options URL or axios request options\n     */\n    public request(options)\n    {\n        let cfg;\n        if (typeof options == \"string\") {\n            cfg = { url: options };\n        } else {\n            cfg = { ...options };\n        }\n\n        cfg.url = this.state.serverUrl.replace(/\\/?$/, \"/\") + cfg.url.replace(/^\\//, \"\");\n        // cfg.url = urlToAbsolute(cfg.url, location);\n\n        // If we are talking to protected fhir server we should have an access token\n        const accessToken = getPath(this.state, \"tokenResponse.access_token\");\n        if (accessToken) {\n            cfg.headers = {\n                ...cfg.headers,\n                Authorization: `Bearer ${accessToken}`\n            };\n        }\n\n        return Adapter.get().http(cfg);\n    }\n\n    public get(p) {\n        // const ret    = Adapter.get().defer();\n        // const params: any = { type: p.resource };\n\n        // if (p.id) {\n        //     params.id = p.id;\n        // }\n\n        // fhirAPI.read(params).then(res => {\n        //     ret.resolve(res.data);\n        // }, () => {\n        //     ret.reject(\"Could not fetch \" + p.resource + \" \" + p.id);\n        // });\n\n        // return ret.promise;\n    }\n\n    public getBinary(url) {\n\n        // const ret = Adapter.get().defer();\n\n        // Adapter.get().http(this.authenticated({\n        //     type: \"GET\",\n        //     url,\n        //     dataType: \"blob\"\n        // }))\n        // .done(blob => ret.resolve(blob))\n        // .fail((...args) => ret.reject(\"Could not fetch \" + url, ...args));\n        // return ret.promise;\n    }\n\n    public fetchBinary(path) {\n        // const url = absolute(path, this.server);\n        // return this.getBinary(url);\n    }\n\n    public authenticated(p) {\n        // // if (this.server.auth.type == \"none\") {\n        // //     return p;\n        // // }\n\n        // let h;\n        // if (this.server.auth.type == \"basic\") {\n        //     h = \"Basic \" + btoa(this.server.auth.username + \":\" + this.server.auth.password);\n        // } else if (this.server.auth.type == \"bearer\") {\n        //     h = \"Bearer \" + this.server.auth.token;\n        // }\n        // if (!p.headers) {\n        //     p.headers = {};\n        // }\n        // p.headers.Authorization = h;\n\n        // return p;\n    }\n}\n","let adapter;\r\n\r\nexport default {\r\n    debug: true,\r\n\r\n    set(newAdapter) {\r\n        adapter = newAdapter;\r\n    },\r\n\r\n    get() {\r\n        return adapter;\r\n    }\r\n};\r\n","import smart   from \"..\";\r\nimport Adapter from \"../adapter\";\r\nimport \"../index\";\r\n\r\n\r\ninterface Window {\r\n    FormData: any;\r\n    ArrayBuffer: any;\r\n}\r\n\r\n\r\nconst jquery = jQuery;\r\n\r\n// Patch jQuery AJAX mechanism to receive blob objects via XMLHttpRequest 2. Based on:\r\n//    https://gist.github.com/aaronk6/bff7cc600d863d31a7bf\r\n//    http://www.artandlogic.com/blog/2013/11/jquery-ajax-blobs-and-array-buffers/\r\n\r\n/**\r\n * Register ajax transports for blob send/receive and array buffer send/receive via XMLHttpRequest Level 2\r\n * within the comfortable framework of the jquery ajax request, with full support for promises.\r\n *\r\n * Notice the +* in the dataType string? The + indicates we want this transport to be prepended to the list\r\n * of potential transports (so it gets first dibs if the request passes the conditions within to provide the\r\n * ajax transport, preventing the standard transport from hogging the request), and the * indicates that\r\n * potentially any request with any dataType might want to use the transports provided herein.\r\n *\r\n * Remember to specify 'processData:false' in the ajax options when attempting to send a blob or ArrayBuffer -\r\n * otherwise jquery will try (and fail) to convert the blob or buffer into a query string.\r\n */\r\njQuery.ajaxTransport(\"+*\", (options, originalOptions, jqXHR) => {\r\n    // Test for the conditions that mean we can/want to send/receive blobs or ArrayBuffers - we need XMLHttpRequest\r\n    // level 2 (so feature-detect against window.FormData), feature detect against window.Blob or window.ArrayBuffer,\r\n    // and then check to see if the dataType is blob/ArrayBuffer or the data itself is a Blob/ArrayBuffer\r\n    if (window.FormData && ((options.dataType && (options.dataType === \"blob\" || options.dataType === \"arraybuffer\")) ||\r\n        (options.data && ((window.Blob && options.data instanceof Blob) ||\r\n            (window.ArrayBuffer && options.data instanceof ArrayBuffer)))\r\n        ))\r\n    {\r\n        return {\r\n            /**\r\n             * Return a transport capable of sending and/or receiving blobs - in this case, we instantiate\r\n             * a new XMLHttpRequest and use it to actually perform the request, and funnel the result back\r\n             * into the jquery complete callback (such as the success function, done blocks, etc.)\r\n             *\r\n             * @param headers\r\n             * @param completeCallback\r\n             */\r\n            send(headers, completeCallback) {\r\n                var xhr      = new XMLHttpRequest(),\r\n                    url      = options.url || window.location.href,\r\n                    type     = options.type || \"GET\",\r\n                    dataType = options.dataType || \"text\",\r\n                    data     = options.data || null,\r\n                    async    = options.async || true,\r\n                    key;\r\n\r\n                xhr.addEventListener(\"load\", () => {\r\n                    var response = {}, status, isSuccess;\r\n\r\n                    isSuccess = xhr.status >= 200 && (xhr.status < 300 || xhr.status === 304);\r\n\r\n                    if (isSuccess) {\r\n                        response[dataType] = xhr.response;\r\n                    } else {\r\n                        // In case an error occurred we assume that the response body contains\r\n                        // text data - so let's convert the binary data to a string which we can\r\n                        // pass to the complete callback.\r\n                        response.text = String.fromCharCode.apply(null, new Uint8Array(xhr.response));\r\n                    }\r\n\r\n                    completeCallback(xhr.status, xhr.statusText, response, xhr.getAllResponseHeaders());\r\n                });\r\n\r\n                xhr.open(type, url, async);\r\n                xhr.responseType = dataType;\r\n\r\n                for (key in headers) {\r\n                    if (headers.hasOwnProperty(key)) {\r\n                        xhr.setRequestHeader(key, headers[key]);\r\n                    }\r\n                }\r\n                xhr.send(data);\r\n            },\r\n            abort(){\r\n                jqXHR.abort();\r\n            }\r\n        };\r\n    }\r\n});\r\n\r\n// if (!process.browser) {\r\n//     var windowObj = require('jsdom').jsdom().createWindow();\r\n//     jquery = jQuery(windowObj);\r\n// }\r\n\r\nfunction defer() {\r\n    const pr: any = jquery.Deferred();\r\n    pr.promise = pr.promise();\r\n    return pr;\r\n}\r\n\r\nconst adapter = {\r\n    defer,\r\n    http(args) {\r\n        const ret = jquery.Deferred();\r\n        const opts = {\r\n            type: args.method,\r\n            url: args.url,\r\n            dataType: args.dataType || \"json\",\r\n            headers: args.headers || {},\r\n            data: args.data,\r\n            // contentType: \"application/json\",\r\n            // data: args.data || args.params,\r\n            // withCredentials: args.credentials === 'include',\r\n        };\r\n        jquery.ajax(opts)\r\n            // .done(ret.resolve)\r\n            // .fail(ret.reject);\r\n            .done((data, status, xhr) => {\r\n                ret.resolve({\r\n                    data,\r\n                    status,\r\n                    headers: xhr.getResponseHeader,\r\n                    config: args\r\n                });\r\n            })\r\n            .fail(err => {\r\n                ret.reject({error: err, data: err, config: args});\r\n            });\r\n        return ret.promise();\r\n    },\r\n    // fhirjs: fhir\r\n};\r\n\r\nAdapter.set(adapter);\r\n\r\n","import { FhirClient as NS }     from \"..\";\n// import * as lib    from \"./lib\";\n// import Client      from \"./Client\";\nimport * as oAuth2 from \"./oauth\";\n\n// const mkFhir = require(\"fhir.js/src/adapters/jquery\");\n\ndeclare global {\n    interface Window {\n        FHIR: any;\n    }\n}\n\nwindow.FHIR = {\n    // lib,\n    // client,\n    // ready(options = {\n    //     baseUrl: \"https://r3.smarthealthit.org/\"\n    // }) {\n    //     // debugger;\n    //     return mkFhir(options);\n    // },\n    oAuth2: {\n        settings: {\n            replaceBrowserHistory    : true,\n            fullSessionStorageSupport: true\n        },\n        authorize(options: NS.ClientOptions) {\n            return oAuth2.authorize(location, options);\n        },\n        ready() {\n            return oAuth2.completeAuth(sessionStorage);\n        }\n    }\n};\n\nexport default {};\n","// This is the shared static library, meaning that it is simple collection of\n// pure functions. It is important for these function to not have side effects\n// so that the file behaves well with tree-shaking (and is fully testable).\n\n/**\n * Walks through an object (or array) and returns the value found at the\n * provided path. This function is very simple so it intentionally does not\n * support any argument polymorphism, meaning that the path can only be a\n * dot-separated string. If the path is invalid returns undefined.\n * @param {Object} obj The object (or Array) to walk through\n * @param {String} path The path (eg. \"a.b.4.c\")\n * @returns {*} Whatever is found in the path or undefined\n */\nexport function getPath(obj: object|any[], path: string = \"\"): any {\n    path = path.trim();\n    if (!path) {\n        return obj;\n    }\n    return path.split(\".\").reduce(\n        (out, key) => out ? (out as any)[key] : undefined,\n        obj\n    );\n}\n\n/**\n * Get the value of the given `p` url parameter. If the parameter is used\n * multiple times the first value will be returned, unless `forceArray` is true\n * (then you get an array of values). If the parameter is not present, `null`\n * will be returned.\n * @param location The base location object\n * @param p The name of the parameter\n * @param forceArray If true, return an array if the param is used multiple times\n */\nexport function urlParam({ search }: Location, p: string, forceArray: boolean = false): string | string[] | null {\n    const query  = search.substr(1);\n    const data   = query.split(\"&\");\n    const result = [];\n\n    for (const pair of data) {\n        const [name, value] = pair.split(\"=\");\n        if (name === p) {\n            result.push(decodeURIComponent(value.replace(/\\+/g, \"%20\")));\n        }\n    }\n\n    if (forceArray) {\n        return result;\n    }\n\n    if (result.length === 0) {\n        return null;\n    }\n\n    return result[0];\n}\n\n/**\n * If the argument string ends with a slash - remove it.\n * @param str The string to trim\n */\nexport function stripTrailingSlash(str?: any) {\n    return String(str || \"\").replace(/\\/+$/, \"\");\n}\n\n/**\n * Converts relative URL to absolute based on the given location\n * @param url The URL to convert\n * @param location The base location object\n */\nexport function urlToAbsolute(url, { protocol, host, pathname }: Location) {\n\n    // root\n    if (url == \"/\") {\n        return protocol + \"//\" + host;\n    }\n\n    // rooted paths\n    if (url.charAt(0) == \"/\") {\n        return protocol + \"//\" + host + url;\n    }\n\n    const srcSegments = String(pathname || \"\")\n        .trim()\n        .replace(/^\\/$/, \"\")\n        .split(\"/\");\n\n    // special links to the current dir\n    if (url === \"\" || url === \".\") {\n        if (pathname.charAt(pathname.length - 1) != \"/\") {\n            srcSegments.pop();\n        }\n        return protocol + \"//\" + host + srcSegments.join(\"/\") + \"/\";\n    }\n\n    const dstSegments = url.split(\"/\");\n\n    if (pathname.charAt(pathname.length - 1) != \"/\") {\n        srcSegments.pop();\n    }\n\n    while (dstSegments.length) {\n        const dst = dstSegments.shift();\n        if (dst == \"..\") {\n            if (srcSegments.length) {\n                srcSegments.pop();\n            }\n        }\n        else if (dst != \".\") {\n            srcSegments.push(dst);\n        }\n    }\n\n    let path = srcSegments.join(\"/\").replace(/\\/+/g, \"/\");\n    if (path == \"/\") {\n        path = \"\";\n    }\n\n    return protocol + \"//\" + host + path;\n}\n\nexport function randomString(strLength = 8, charSet = null) {\n    const result = [];\n\n    charSet = charSet || \"ABCDEFGHIJKLMNOPQRSTUVWXYZ\" +\n                         \"abcdefghijklmnopqrstuvwxyz\" +\n                         \"0123456789\";\n\n    const len = charSet.length;\n    while (strLength--) {\n        result.push(charSet.charAt(Math.floor(Math.random() * len)));\n    }\n    return result.join(\"\");\n}\n","import { FhirClient as NS, FhirClient, fhir }  from \"..\";\nimport { btoa }                                from \"Base64\";\nimport Adapter                                 from \"./adapter\";\nimport Client                                  from \"./Client\";\nimport {\n    urlParam,\n    getPath,\n    urlToAbsolute,\n    randomString\n} from \"./lib\";\n\n\nfunction debug(...args) {\n    if (process.env.DEBUG) {\n        console.log(...args);\n    }\n}\n\nexport async function fetchConformanceStatement(baseUrl?: string): Promise<fhir.CapabilityStatement> {\n    const url = String(baseUrl || \"\").replace(/\\/*$/, \"/\") + \"metadata\";\n    let metadata;\n    try {\n        metadata = await Adapter.get().http({ method: \"GET\", url });\n    } catch (ex) {\n        console.error(ex);\n        throw new Error(`Failed to fetch the conformance statement from \"${url}\"`);\n    }\n    return metadata.data;\n}\n\n/**\n * Given a fhir server returns an object with it's Oauth security endpoints\n * @param baseUrl Fhir server base URL\n */\nexport function getSecurityExtensions(metadata?: fhir.CapabilityStatement): NS.OAuthSecurityExtensions {\n    const nsUri = \"http://fhir-registry.smarthealthit.org/StructureDefinition/oauth-uris\";\n    const extensions = (getPath(metadata || {}, \"rest.0.security.extension\") || [])\n        .filter(e => e.url === nsUri)\n        .map(o => o.extension)[0];\n\n    const out: NS.OAuthSecurityExtensions = {\n        registrationUri : \"\",\n        authorizeUri    : \"\",\n        tokenUri        : \"\"\n    };\n\n    if (extensions) {\n        extensions.forEach(ext => {\n            if (ext.url === \"register\") {\n                out.registrationUri = ext.valueUri;\n            }\n            if (ext.url === \"authorize\") {\n                out.authorizeUri = ext.valueUri;\n            }\n            if (ext.url === \"token\") {\n                out.tokenUri = ext.valueUri;\n            }\n        });\n    }\n    return out;\n}\n\n/**\n * Calls the buildAuthorizeUrl function to construct the redirect URL and then\n * just redirects to it.\n */\nexport async function authorize(location: Location, options: NS.ClientOptions): Promise<any> {\n    debug(`Authorizing...`);\n    const redirect = await buildAuthorizeUrl(location, options);\n    debug(`Making authorize redirect to ${redirect}`);\n    location.href = redirect;\n}\n\n/**\n * First discovers the fhir server base URL from query.iis or query.fhirServiceUrl\n * or options.serverUrl. Then compiles the proper authorization URL for that server.\n * For open servers that URL is the options.redirectUri so that we can skip the\n * authorization part.\n */\nexport async function buildAuthorizeUrl(location: Location, options: NS.ClientOptions): Promise<string> {\n    const launch         = urlParam(location, \"launch\");\n    const iss            = urlParam(location, \"iss\");\n    const fhirServiceUrl = urlParam(location, \"fhirServiceUrl\");\n\n    const serverUrl = String(iss || fhirServiceUrl || options.serverUrl || \"\");\n\n    if (iss && !launch) {\n        throw new Error(`Missing url parameter \"launch\"`);\n    }\n\n    if (!serverUrl) {\n        throw new Error(\n            \"No server url found. It must be specified as query.iss or \" +\n            \"query.fhirServiceUrl or options.serverUrl (in that order)\"\n        );\n    }\n\n    debug(`Looking up the authorization endpoint for \"${serverUrl}\"`);\n    const metadata   = await fetchConformanceStatement(serverUrl);\n    const extensions = getSecurityExtensions(metadata);\n    debug(`Found security extensions: `, extensions);\n\n    // Prepare the object that will be stored in the session\n    const state: NS.ClientState = {\n        serverUrl,\n        clientId   : options.clientId,\n        redirectUri: urlToAbsolute(options.redirectUri || \"\", location),\n        scope      : options.scope || \"\",\n        ...extensions\n    };\n\n    if (options.clientSecret) {\n        debug(`Adding clientSecret to the state`);\n        state.clientSecret = options.clientSecret;\n    }\n\n    const id = randomString(32);\n    sessionStorage.setItem(id, JSON.stringify(state));\n    // sessionStorage.setItem(tokenResponse, JSON.stringify(state));\n\n    let redirectUrl = state.redirectUri;\n    // debug(state);\n    if (state.authorizeUri) {\n        debug(`authorizeUri: ${state.authorizeUri}`);\n        const params = [\n            \"response_type=code\",\n            \"client_id=\"    + encodeURIComponent(state.clientId),\n            \"scope=\"        + encodeURIComponent(state.scope),\n            \"redirect_uri=\" + encodeURIComponent(state.redirectUri),\n            \"aud=\"          + encodeURIComponent(state.serverUrl),\n            \"state=\"        + id\n        ];\n\n        // also pass this in case of EHR launch\n        if (launch) {\n            params.push(\"launch=\" + encodeURIComponent(launch as string));\n        }\n\n        redirectUrl = state.authorizeUri + \"?\" + params.join(\"&\");\n    }\n\n    return redirectUrl;\n}\n\nexport function getState(id: string): FhirClient.ClientState {\n    if (!id) {\n        throw new Error(`Cannot look up state by the given id (${id})`);\n    }\n    const cached = sessionStorage.getItem(id as string);\n    if (!cached) {\n        throw new Error(`No state found by the given id (${id})`);\n    }\n    try {\n        const json = JSON.parse(cached);\n        return json;\n    } catch (_) {\n        throw new Error(`Corrupt state: sessionStorage['${id}'] cannot be parsed as JSON.`);\n    }\n}\n\n/**\n * Builds the token request options for axios. Does not make the request, just\n * creates it's configuration and returns it in a Promise.\n * NOTE that this function has side effects because it modifies the storage\n * contents.\n * @param req\n * @param storage\n */\nexport function buildTokenRequest(code: string, state: FhirClient.ClientState): any {\n\n    if (!state.redirectUri) {\n        throw new Error(`Missing state.redirectUri`);\n    }\n\n    if (!state.tokenUri) {\n        throw new Error(`Missing state.tokenUri`);\n    }\n\n    if (!state.clientId) {\n        throw new Error(`Missing state.clientId`);\n    }\n\n    const requestOptions: any = {\n        method: \"POST\",\n        url   : state.tokenUri,\n        headers: {\n            \"content-type\": \"application/x-www-form-urlencoded\"\n        },\n        data: {\n            code,\n            grant_type  : \"authorization_code\",\n            redirect_uri: state.redirectUri\n        }\n    };\n\n    // For public apps, authentication is not possible (and thus not\n    // required), since the app cannot be trusted to protect a secret.\n    // For confidential apps, an Authorization header using HTTP Basic\n    // authentication is required, where the username is the apps client_id\n    // and the password is the apps client_secret\n    if (state.clientSecret) {\n        requestOptions.headers.Authorization = \"Basic \" + btoa(\n            state.clientId + \":\" + state.clientSecret\n        );\n        debug(\n            `Using state.clientSecret to construct the authorization header: \"${\n            requestOptions.headers.Authorization}\"`\n        );\n    } else {\n        debug(`No clientSecret found in state. Adding client_id to the POST body`);\n        requestOptions.data.client_id = state.clientId;\n    }\n\n    return requestOptions;\n}\n\n/**\n * After successful authorization we have received a code and state parameters.\n * Use this function to exchange that code for an access token and complete the\n * authorization flow.\n */\nexport async function completeAuth(storage: Storage): Promise<Client> {\n    debug(\"Completing the code flow\");\n    const state          = urlParam(location, \"state\");\n    const code           = urlParam(location, \"code\");\n    const cached         = getState(state as string);\n    const requestOptions = buildTokenRequest(code as string, cached);\n\n    // The EHR authorization server SHALL return a JSON structure that\n    // includes an access token or a message indicating that the\n    // authorization request has been denied.\n    return Adapter.get().http(requestOptions)\n        .then(({ data }) => {\n            debug(`Received tokenResponse. Saving it to the state...`);\n            cached.tokenResponse = data;\n            storage.setItem(state as string, JSON.stringify(cached));\n        })\n        .then(() => new Client(cached));\n    //     .catch(result => {\n    //         throw handleTokenError(result);\n    //     });\n}\n"],"sourceRoot":""}